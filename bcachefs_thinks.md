
稍微讲一下bcachefs现在的感想:

我已经把Windows上要访问的NTFS镜像的所在文件系统转换成了bcachefs,并使用了几个月, 配置是3个HDD加1个SSD, 并且设置大部分数据的冗余度为2. 并且使用自己写的脚本对相关磁盘镜像每10分钟做快照并管理(删除)旧快照.

先说结论, 在这个bcachefs自己宣布拿掉"实验性"的标志之前, 这个文件系统不应该作为生产用. 如果需要尝鲜的话, 你是确实需要有妥善的备份方案的. 但是非常值得尝鲜.

RT: https://t.copyliu.org/@copyliu/115449732533085260
> 最后原罪就是HDD慢! 任何不依靠SSD的灵光一闪都是花拳绣腿!

但是为什么bcachefs值得尝试并且大有可为? bcachefs是为数不多的能用SSD确实提升文件系统效率的分层文件系统, 这里的分层是指, SSD除了提供缓存之外, 也能够指定能够存放何种数据, 并且控制粒度可以到文件级. 在bcachefs中, 你可以设置文件系统/子卷/目录/文件各自有自己的冗余策略和读写设备策略. 请再一次体会刚刚的那句话. 你可以对每一个文件, 控制冗余度是几份, 控制它应该存放到哪个(或者哪组)设备, 控制它是否应当有读缓存, 缓存设备是哪个(哪组), 控制他是否应当有写缓存, 写缓存设备是哪个(哪组). 光是这一个特性就可以彻底理解为什么bcachefs值得尝试.

那么, 他和btrfs有什么不同? btrfs不提供分层策略, 虽然有第三方补丁可以将metadata移到SSD用来加速, 但这个补丁本身其实和btrfs的设计思路相悖. 其他特性其实和btrfs非常相近, 不管是子卷/快照, 不管是COW, 不管是透明压缩等等, 还有增减硬盘的灵活性, 异构(不同容量)硬盘混合使用等等. 可以说最大的不同就是分层存储. 

那么, 他和ZFS有什么不同? ZFS确实特性上非常先进但是ZFS有个设计思路需要你留意: ZFS是设计为超大型存储池使用的文件系统. 超大型是指硬盘数量超过10并且依照企业级的固定资产汰换策略进行维护和扩展. 说人话就是, 除了设计上是很多硬盘之外, 在扩展时你需要投入整套完整的存储设备整套更换或者整套并行. 所谓整套就是你原来是10个硬盘的池, 那么再向该池投入的时候, 也应当是10硬盘整套更换或者20硬盘并行运作. 请仔细体会这一个设计思路. 

恰逢AI泡沫带来的存储硬件供应紧张, 能够混合使用不同容量, 甚至不同种类的硬盘其实是家庭级专业用户和中小企专业用户非常迫需的特性. ZFS和btrfs都做不到这一点.

当前bcachefs(2025年末)已经非常接近拿掉"实验性"的标志, 并且正在高速发展中, 我是建议尝鲜用户加入到开发IRC中, 虽然作者(曾)非常自豪地自称他知道的用户里没有遇到过数据彻底丢失的事例, 但是确实偶尔会有影响使用甚至影响数据完整性的bug, 但是只要正确反馈到IRC, 作者都会即刻修复, 并在数天内发布成新版本, 并且都可以有补救办法(前提是你需要很熟悉Linux的操作包括编译软件包等)
